:ruby
  unit_id = current_user.unit_id.nil? ? session[:unit_id] : current_user.unit_id
%p.close{:onclick => "trst.task.destroy()"}
%p.task_title= current_title(@task,action)
%span#hidden_data.hidden{:data => {:task_id => @task.id, :js => "acc.cache", :action => "filter"}}
- if unit_id
  - if current_user.unit_id.nil?
    = partial('trst_sys/shared/select_unit')
    %form{:id  => "xhr_#{action}"}
      %table{:cellspacing => "0"}
        %tbody
          %tr
            %td
              %select.dp
                %option{:value => 'null'}= TrstAccCache.by_unit_id(unit_id).empty? ? t('select.no_data') : t('select.select')
                - unless TrstAccCache.by_unit_id(unit_id).empty?
                  - TrstAccCache.by_unit_id(unit_id).asc(:id_date).each do |o|
                    %option{:value => o.id}
                      = option_name(o)
        %tfoot
          %tr
            %td{:class => "buttons_bottom"}
              %span{:class => "button post mc-evt"}= t("button.post")
              %span{:class => "button cancel mc-evt"}= t("button.cancel")
  - else
    %p.small= t('trst_acc_cache.filter_info.unit')
    %form{:id  => "xhr_#{action}"}
      %table{:cellspacing => "0"}
        %tfoot
          %tr
            %td{:class => "buttons_bottom"}
              %span{:class => "button post mc-evt"}= t("button.post")
              %span{:class => "button cancel mc-evt"}= t("button.cancel")
- else
  = partial('trst_sys/shared/select_unit')
