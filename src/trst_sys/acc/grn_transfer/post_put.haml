%p.close{:onclick => "trst.task.destroy()"}
-if action == 'put'
  %p.task_title= current_title(@task,action)
  %span#hidden_data.hidden{:data => {:task_id => @task.id, :js => "acc.grn_transfer", :action => "put", :object_id => "#{@object.id}"}}
  %form{:id  => "xhr_#{action}"}
    %table{:cellspacing => "0"}
      %thead
        %tr
          %td{:colspan => "4"}
            %span.small= t('trst_acc_grn_transfer.put.thead.label_01', :name => @object.name)
            %input{:type => "hidden",:name => "[trst_acc_grn][name]",:value => @object.name}
            %span.small= t('trst_acc_grn_transfer.put.thead.label_02')
            %input.date{:name => "[trst_acc_grn][id_date]",:value => @object.id_date.to_s}
        %tr
          %td{:colspan => "4"}
            %span.small= t('trst_acc_grn_transfer.put.thead.label_03', :name => TrstPartner.intern.first.name[2])
            %input{:type => "hidden", :name => "[trst_acc_grn][supplier_id]", :value => @object.supplier_id}
        %tr
          %td{:colspan => "4"}
            = partial('trst_sys/shared/select_delegate', :locals => {:partner_id => @object.supplier_id})
        %tr
          %td{:colspan => "4"}
            %hr
            %span.small{:style => "display:block; max-width:400px"}= t('trst_acc_grn_transfer.put.thead.label_04', :dns => @object.delivery_notes.map{|dn| dn.id_main_doc}.join(', '))
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_type]", :value => "DN"}
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_name]", :value => @object.delivery_notes.map{|dn| dn.id_main_doc}.join(', ')}
        %tr
          %td{:colspan => "4"}
            %hr
            %span.small= t('trst_acc_grn_transfer.put.thead.label_05')
      %tbody.inner
        %tr.ce
          - t('trst_acc_grn_transfer.put.tbody').each do |label|
            %td= label
        - data = @object.delivery_notes.sum_freights_grn; data.sort.each_with_index do |s,i|
          %tr.to-calculate
            %td
              %span.freight= s[1][0]
              %input{:type => "hidden", :name => "[freights][#{i}][freight_id]", :value => TrstAccFreight.by_unit_id(@object.unit_id).by_id_stats(s[1][1]).first.id}
              %input{:type => "hidden", :name => "[freights][#{i}][id_stats]", :value => s[1][1]}
            %td
              %span.qu{:style => "width:80%"}= "%.2f" % s[1][2]
              %input{:type => "hidden", :name => "[freights][#{i}][pu]", :value => s[1][2]}
            %td
              %span.val{:style => "width:80%"}= "%.2f" % s[1][3]
              %input{:type => "hidden", :name => "[freights][#{i}][qu]", :value => s[1][3]}
            %td
              %span.val{:style => "width:80%"}= "%.2f" % s[1][4]
              %input{:type => "hidden", :name => "[freights][#{i}][val]", :value => s[1][4]}
        %tr.result
          %td.ce.st{:colspan => "3"}= "Total"
          %td
            %span.val{:style => "width:80%"}= "%.2f" % data.values.sum{|r| r[4]}
            %input{:type => "hidden", :name => "[trst_acc_grn][sum_100]", :value => data.values.sum{|r| r[4]}.round(2)}
            %input{:type => "hidden", :name => "[trst_acc_grn][sum_pay]", :value => data.values.sum{|r| r[4]}.round(2)}
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_paym]", :value => "Transfer gestiune"}
      %tfoot
        %tr
          %td{:class => "buttons_bottom", :colspan => "4"}
            %span{:class => "button save mc-evt"}= t("button.save")
            %span{:class => "button delete mc-evt"}= t("button.delete")

-else
  %p.task_title= t('trst_acc_dn_transfer.title')
  %span#hidden_data.hidden{:data => {:task_id => @task.id, :js => "acc.grn_transfer", :action => "post", :object_id => "#{@object.id rescue nil}"}}
  %table{:cellspacing => "0"}
    %thead
      %tr
        %th= t("gen_warning.#{action}")
    %tbody
      %tr
        %td
          %p.ju{:style => "width:350px"}= t("gen_msg.#{action}", :data => "#{@object.name}")
    %tfoot
      %tr
        %td{:class => "buttons_bottom"}
          - current_buttons(action).each do |button|
            %span{:class => "button #{button}", :onclick => current_xhr(button,@task.id,action,"new",params)}<
              =t("button.#{button}")
