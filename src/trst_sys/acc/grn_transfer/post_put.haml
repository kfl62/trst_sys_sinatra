%p.close{:onclick => "trst.task.destroy()"}
-if action == 'put'
  %p.task_title= current_title(@task,action)
  %form{:id  => "xhr_#{action}"}
    %table{:cellspacing => "0"}
      %thead
        %tr
          %td{:colspan => "4"}
            %span.small= "Nr.intern <b>#{@object.name}</b>"
            %input{:type => "hidden",:name => "[trst_acc_grn][name]",:value => @object.name}
            %span.small din data de:
            %input.date{:name => "[trst_acc_grn][id_date]",:value => @object.id_date.to_s}
        %tr
          %td{:colspan => "4"}
            %span.small= "De la furnizorul: #{TrstPartner.intern.first.name[2]} prin delegat:"
            %input{:type => "hidden", :name => "[trst_acc_grn][supplier_id]", :value => @object.supplier_id}
        %tr
          %td{:colspan => "4"}
            = partial('trst_sys/shared/select_delegate', :locals => {:partner_id => @object.supplier_id})
        %tr
          %td{:colspan => "4"}
            %span.small{:style => "display:block; max-width:400px"}= "Cu avizele: #{@object.delivery_notes.map{|dn| dn.id_main_doc}.join(', ')}"
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_type]", :value => "DN"}
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_name]", :value => @object.delivery_notes.map{|dn| dn.id_main_doc}.join(', ')}
        %tr
          %td{:colspan => "4"}
            %span.small S-au recepţionat următoarele:
      %tbody.inner
        %tr.ce
          %td Material
          %td Preţ (lei/kg)
          %td Cantitate
          %td Valoare
        - data = @object.delivery_notes.sum_freights_grn; data.sort.each_with_index do |s,i|
          %tr.to-calculate
            %td
              %span.freight= s[1][0]
              %input{:type => "hidden", :name => "[freights][#{i}][freight_id]", :value => TrstAccFreight.by_unit_id(@object.unit_id).by_id_stats(s[1][1]).first.id}
              %input{:type => "hidden", :name => "[freights][#{i}][id_stats]", :value => s[1][1]}
            %td
              %span.qu{:style => "width:80%"}= "%.2f" % s[1][2]
              %input{:type => "hidden", :name => "[freights][#{i}][pu]", :value => s[1][2]}
            %td
              %span.val{:style => "width:80%"}= "%.2f" % s[1][3]
              %input{:type => "hidden", :name => "[freights][#{i}][qu]", :value => s[1][3]}
            %td
              %span.val{:style => "width:80%"}= "%.2f" % s[1][4]
              %input{:type => "hidden", :name => "[freights][#{i}][val]", :value => s[1][4]}
        %tr.result
          %td.ce.st{:colspan => "3"}= "Total"
          %td
            %span.val{:style => "width:80%"}= "%.2f" % data.values.sum{|r| r[4]}
            %input{:type => "hidden", :name => "[trst_acc_grn][sum_100]", :value => data.values.sum{|r| r[4]}.round(2)}
            %input{:type => "hidden", :name => "[trst_acc_grn][sum_pay]", :value => data.values.sum{|r| r[4]}.round(2)}
            %input{:type => "hidden", :name => "[trst_acc_grn][main_doc_paym]", :value => "Transfer gestiune"}
      %tfoot
        %tr
          %td{:class => "buttons_bottom", :colspan => "4"}
            %span{:class => "button save", :onclick => "trst.task.acc.validDelegate('#{@task.id}','#{@object.id}')"}= t("button.save")
            %span{:class => "button delete", :onclick => "trst.task.init('#{@task.id}','delete','#{@object.id}')"}= t("button.delete")

-else
  %p.task_title= t('trst_acc_dn_transfer.title')
  %table{:cellspacing => "0"}
    %thead
      %tr
        %th= t("gen_warning.#{action}")
    %tbody
      %tr
        %td
          %p.ju{:style => "width:350px"}= t("gen_msg.#{action}", :data => "#{@object.name}")
    %tfoot
      %tr
        %td{:class => "buttons_bottom"}
          - current_buttons(action).each do |button|
            %span{:class => "button #{button}", :onclick => current_xhr(button,@task.id,action,"new",params)}<
              =t("button.#{button}")
